<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agent Graph Studio — v2</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="shell">
      <!-- TOPBAR -->
      <header class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div class="title">Agent Graph Studio</div>
        </div>

        <div class="searchrow">
          <input
            id="query"
            class="input"
            placeholder="Ask anything… (⇧⏎ to run)"
          />
          <button id="runBtn" class="btn primary">Run</button>
        </div>

        <div class="top-controls">
          <button id="fitBtn" class="btn" title="Fit to content">Fit</button>
          <button id="zoomInBtn" class="btn" title="Zoom in">＋</button>
          <button id="zoomOutBtn" class="btn" title="Zoom out">－</button>
        </div>

        <div class="status" id="status">Ready.</div>
      </header>

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="side-header">
          <div class="tabs">
            <button class="tab active" data-tab="history">Runs</button>
            <button class="tab" data-tab="nodes">Nodes</button>
            <button class="tab" data-tab="settings">Settings</button>
          </div>
          <button
            id="openPalette"
            class="btn"
            title="Command palette (Ctrl/Cmd + K)"
          >
            ⌘K
          </button>
        </div>
        <div class="side-content" id="tab-history">
          <div class="list" id="runHistory"></div>
        </div>
        <div class="side-content" id="tab-nodes" style="display: none">
          <div class="list" id="nodeList"></div>
        </div>
        <div class="side-content" id="tab-settings" style="display: none">
          <div class="list">
            <div class="list-item">
              <div>
                <div style="font-weight: 700">API Base</div>
                <div class="meta">Change your backend URL</div>
              </div>
              <input
                id="apiBase"
                class="input"
                value="http://localhost:8000"
                style="width: 220px"
              />
            </div>
            <div class="list-item">
              <div>
                <div style="font-weight: 700">Shortcuts</div>
                <div class="meta">
                  ⇧⏎ run • ⌘/Ctrl + K palette • ⌘/Ctrl + +/- zoom
                </div>
              </div>
              <span class="kbd">?</span>
            </div>
          </div>
        </div>
        <div class="side-footer">
          <button id="newRunBtn" class="btn">New Run</button>
          <button id="clearBtn" class="btn">Clear</button>
        </div>
      </aside>

      <!-- MAIN / CANVAS -->
      <main class="main">
        <div class="canvas-toolbar">
          <button id="hudFit" class="icon-btn" title="Fit">⌗</button>
          <button id="hudZoomIn" class="icon-btn" title="Zoom in">＋</button>
          <button id="hudZoomOut" class="icon-btn" title="Zoom out">－</button>
        </div>
        <div class="minimap"><svg id="minimap" viewBox="0 0 100 60"></svg></div>
        <div id="viewport" class="viewport">
          <div class="layers">
            <svg
              id="edges"
              class="edges"
              xmlns="http://www.w3.org/2000/svg"
            ></svg>
            <div id="nodesLayer" class="nodes"></div>
          </div>
        </div>

        <!-- RIGHT DRAWER: NODE INSPECTOR -->
        <aside id="nodePanel" class="drawer hidden" aria-hidden="true">
          <div class="drawer-header">
            <span id="nodePanelTitle">Node details</span>
            <div style="display: flex; gap: 8px; align-items: center">
              <span class="kbd">Esc</span>
              <button id="closeNode" class="btn">Close</button>
            </div>
          </div>
          <pre id="nodeContent" class="drawer-body"></pre>
        </aside>

        <!-- BOTTOM DRAWER: FINAL ANSWER -->
        <section class="bottom" id="finalDrawer" aria-expanded="true">
          <div class="bottom-header">
            <span>Final Answer</span>
            <div class="bottom-actions">
              <button id="copyFinal" class="btn" title="Copy">Copy</button>
              <button id="btnHideFinal" class="btn">Hide</button>
              <button id="btnExpandFinal" class="btn">Expand</button>
              <button id="btnMaxFinal" class="btn">Max</button>
            </div>
          </div>
          <div id="finalContent" class="bottom-body">No answer yet.</div>
        </section>
      </main>
    </div>

    <!-- COMMAND PALETTE MODAL -->
    <div id="palette" class="modal-overlay">
      <div
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-label="Command palette"
      >
        <div class="modal-header">
          <input
            id="paletteSearch"
            class="input"
            placeholder="Type a command…"
          />
          <span class="kbd">Esc</span>
        </div>
        <div class="modal-body" id="paletteList">
          <div class="cmd" data-action="newRun">
            <span>New run</span><span class="kbd">N</span>
          </div>
          <div class="cmd" data-action="fit">
            <span>Fit to content</span><span class="kbd">F</span>
          </div>
          <div class="cmd" data-action="zoomIn">
            <span>Zoom in</span><span class="kbd">+</span>
          </div>
          <div class="cmd" data-action="zoomOut">
            <span>Zoom out</span><span class="kbd">-</span>
          </div>
          <div class="cmd" data-action="clear">
            <span>Clear canvas</span><span class="kbd">⌫</span>
          </div>
          <div class="cmd" data-action="settings">
            <span>Open settings</span><span class="kbd">,</span>
          </div>
        </div>
      </div>
    </div>

    <!-- TOASTS -->
    <div class="toast" id="toast"></div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module" src="./main.js"></script>
  </body>
</html>
